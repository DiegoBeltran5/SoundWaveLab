<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SoundWave Lab - Laboratorio de S√≠ntesis Musical</title>
  <style>
    /* Estilos principales omitidos por brevedad aqu√≠ (son iguales a los tuyos)
       Solo elimina .spectrum-analyzer y #spectrumCanvas en tu CSS original. */
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>SoundWave Lab</h1>
      <p class="subtitle">Laboratorio de S√≠ntesis Musical con Funciones Trigonom√©tricas</p>
    </header>

    <div class="main-panel">
      <div class="equation-display" id="equation"></div>

      <div class="wave-display">
        <canvas id="waveCanvas"></canvas>
      </div>

      <div class="controls-section">
        <div class="control-group">
          <h3><span>üéöÔ∏è</span> Par√°metros de Onda</h3>

          <div class="slider-container">
            <div class="slider-label">
              <span>Amplitud (A)</span>
              <span id="ampValue">0.5</span>
            </div>
            <input type="range" id="amplitude" min="0" max="1" step="0.01" value="0.5" />
          </div>

          <div class="slider-container">
            <div class="slider-label">
              <span>Frecuencia (Hz)</span>
              <span id="freqValue">440</span>
            </div>
            <input type="range" id="frequency" min="100" max="1000" step="1" value="440" />
          </div>

          <div class="slider-container">
            <div class="slider-label">
              <span>Fase (œÜ)</span>
              <span id="phaseValue">0</span>
            </div>
            <input type="range" id="phase" min="0" max="6.28" step="0.01" value="0" />
          </div>
        </div>

        <div class="control-group">
          <h3><span>üéπ</span> Control de Reproducci√≥n</h3>

          <button class="play-button" id="playButton">‚ñ∂ REPRODUCIR ONDA</button>

          <div class="slider-container" style="margin-top: 20px;">
            <div class="slider-label">
              <span>Tipo de Onda</span>
              <span id="waveTypeText">Seno</span>
            </div>
            <select id="waveType" style="width: 100%; padding: 10px;">
              <option value="sine">Seno</option>
              <option value="cosine">Coseno</option>
              <option value="square">Cuadrada</option>
              <option value="sawtooth">Sierra</option>
              <option value="triangle">Triangular</option>
            </select>
          </div>
        </div>
      </div>

      <div class="piano-keys" id="pianoKeys"></div>

      <div class="info-panel">
        <h4>üéµ ¬øSab√≠as que...?</h4>
        <p>
          Las funciones trigonom√©tricas son la base de todo sonido musical. La funci√≥n seno representa la onda m√°s pura,
          mientras que los instrumentos reales crean ondas complejas combinando m√∫ltiples funciones senoidales. La frecuencia determina el tono (nota musical) y la amplitud determina el volumen.
        </p>
      </div>
    </div>
  </div>

  <script>
    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let oscillator = null;
    let gainNode = null;
    let isPlaying = false;

    const canvas = document.getElementById("waveCanvas");
    const ctx = canvas.getContext("2d");

    const ampSlider = document.getElementById("amplitude");
    const freqSlider = document.getElementById("frequency");
    const phaseSlider = document.getElementById("phase");
    const playButton = document.getElementById("playButton");
    const waveTypeSelect = document.getElementById("waveType");

    const ampValue = document.getElementById("ampValue");
    const freqValue = document.getElementById("freqValue");
    const phaseValue = document.getElementById("phaseValue");
    const equationDisplay = document.getElementById("equation");

    function resizeCanvas() {
      canvas.width = canvas.offsetWidth;
      canvas.height = canvas.offsetHeight;
    }
    resizeCanvas();
    window.addEventListener("resize", resizeCanvas);

    function updateEquation() {
      const amp = ampSlider.value;
      const freq = freqSlider.value;
      const phase = (parseFloat(phaseSlider.value) / Math.PI).toFixed(2);
      let waveFunction = waveTypeSelect.value === "cosine" ? "cos" : "sen";
      equationDisplay.innerHTML = `${amp}¬∑${waveFunction}(2œÄ¬∑${freq}Hz¬∑t + ${phase}œÄ)`;
    }

    function drawWave() {
      const width = canvas.width;
      const height = canvas.height;
      const amp = parseFloat(ampSlider.value);
      const freq = parseFloat(freqSlider.value);
      const phase = parseFloat(phaseSlider.value);

      ctx.clearRect(0, 0, width, height);
      ctx.strokeStyle = "#00ffff";
      ctx.lineWidth = 2;
      ctx.beginPath();

      for (let x = 0; x < width; x++) {
        const t = (x / width) * (1 / freq);
        let y;
        switch (waveTypeSelect.value) {
          case "sine":
            y = amp * Math.sin(2 * Math.PI * freq * t + phase);
            break;
          case "cosine":
            y = amp * Math.cos(2 * Math.PI * freq * t + phase);
            break;
          case "square":
            y = amp * (Math.sin(2 * Math.PI * freq * t + phase) > 0 ? 1 : -1);
            break;
          case "sawtooth":
            y = amp * (2 * (t * freq - Math.floor(t * freq + 0.5)));
            break;
          case "triangle":
            y = amp * (2 * Math.abs(2 * (t * freq - Math.floor(t * freq + 0.5))) - 1);
            break;
        }
        const pixelY = height / 2 - y * height / 2 * 0.8;
        if (x === 0) {
          ctx.moveTo(x, pixelY);
        } else {
          ctx.lineTo(x, pixelY);
        }
      }

      ctx.stroke();
    }

    function toggleSound() {
      if (isPlaying) {
        stopSound();
      } else {
        playSound();
      }
    }

    function playSound() {
      oscillator = audioContext.createOscillator();
      gainNode = audioContext.createGain();

      oscillator.type = waveTypeSelect.value === "cosine" ? "sine" : waveTypeSelect.value;
      oscillator.frequency.value = parseFloat(freqSlider.value);
      gainNode.gain.value = parseFloat(ampSlider.value);

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      oscillator.start();
      isPlaying = true;
      playButton.textContent = "‚è∏ DETENER";
      playButton.classList.add("playing");
    }

    function stopSound() {
      if (oscillator) {
        oscillator.stop();
        oscillator = null;
      }
      isPlaying = false;
      playButton.textContent = "‚ñ∂ REPRODUCIR ONDA";
      playButton.classList.remove("playing");
    }

    function updateValues() {
      ampValue.textContent = ampSlider.value;
      freqValue.textContent = freqSlider.value;
      phaseValue.textContent = (parseFloat(phaseSlider.value) / Math.PI).toFixed(2) + "œÄ";
      if (oscillator) {
        oscillator.frequency.value = parseFloat(freqSlider.value);
        gainNode.gain.value = parseFloat(ampSlider.value);
      }
      updateEquation();
      drawWave();
    }

    const notes = [
      { note: "C4", freq: 261.63, white: true },
      { note: "C#4", freq: 277.18, white: false },
      { note: "D4", freq: 293.66, white: true },
      { note: "D#4", freq: 311.13, white: false },
      { note: "E4", freq: 329.63, white: true },
      { note: "F4", freq: 349.23, white: true },
      { note: "F#4", freq: 369.99, white: false },
      { note: "G4", freq: 392.0, white: true },
      { note: "G#4", freq: 415.3, white: false },
      { note: "A4", freq: 440.0, white: true },
      { note: "A#4", freq: 466.16, white: false },
      { note: "B4", freq: 493.88, white: true },
    ];

    function createPianoKeys() {
      const pianoContainer = document.getElementById("pianoKeys");
      pianoContainer.innerHTML = "";
      notes.forEach((note) => {
        const key = document.createElement("div");
        key.className = `piano-key ${note.white ? "" : "black"}`;
        key.innerHTML = `<span class="key-label">${note.note.replace("4", "")}</span>`;
        key.addEventListener("mousedown", () => {
          freqSlider.value = note.freq;
          updateValues();
          if (!isPlaying) {
            playSound();
          }
          key.classList.add("active");
        });
        key.addEventListener("mouseup", () => key.classList.remove("active"));
        key.addEventListener("mouseleave", () => key.classList.remove("active"));
        pianoContainer.appendChild(key);
      });
    }

    ampSlider.addEventListener("input", updateValues);
    freqSlider.addEventListener("input", updateValues);
    phaseSlider.addEventListener("input", updateValues);
    playButton.addEventListener("click", toggleSound);
    waveTypeSelect.addEventListener("change", () => {
      updateValues();
      if (isPlaying) {
        stopSound();
        playSound();
      }
    });

    createPianoKeys();
    updateValues();
    drawWave();
  </script>
</body>
</html>
